
{% extends "base.html" %}

{% block content %}
<h1>MQTT Management</h1>

<div>
    <h3>MQTT Configuration</h3>
    <form id="mqtt-config-form">
        <label for="mqtt-host">Host:</label>
        <input type="text" id="mqtt-host" name="host" required>
        <label for="mqtt-port">Port:</label>
        <input type="number" id="mqtt-port" name="port" value="1883" required>
        <label for="mqtt-topic">Topic:</label>
        <input type="text" id="mqtt-topic" name="topic" required>
        <button type="submit">Connect</button>
    </form>
</div>

<div class="mt-4">
    <h3>MQTT Messages</h3>
    <div id="mqtt-messages" class="border bg-light p-3" style="height: 300px; overflow-y: auto;">
        <!-- MQTT messages will appear here -->
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    $(document).ready(function () {
        $("#mqtt-config-form").on("submit", function (event) {
            event.preventDefault();
            const formData = $(this).serialize();
            $.post("/mqtt/connect", formData, function (response) {
                alert(response.message);
            });
        });

        const mqttMessages = $("#mqtt-messages");
        const socket = io();

        socket.on("mqtt_message", function (data) {
            mqttMessages.append(`<div>${data.topic}: ${data.message}</div>`);
            mqttMessages.scrollTop(mqttMessages.prop("scrollHeight"));
        });
    });
</script>
{% endblock %}

